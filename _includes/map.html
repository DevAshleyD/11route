<body class="site" onload="initialize();">

<div id="container">
  <div id="back">
    <a href="/">Home</a>
  </div>
  <div id="map"></div>

  {% assign posts=site.posts | where:"lang", page.lang %}
</div>

<script type="text/javascript">
  function initialize() {
    var mapOptions = {
      center: new google.maps.LatLng(10, -10),
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      zoom: 3
    };

    var posts = [
      {% for post in posts %}
      {
        "lat": {{ post.latitude }},
        "lon": {{ post.longitude }},
        "title": "{{ post.title }}",
        "url": "{{ post.url | prepend: site.baseurl }}"
      }
      {% unless forloop.last %},{% endunless %}
      {% endfor %}
    ];

    var map = new google.maps.Map(document.getElementById("map"), mapOptions),
        markers = [];

    posts.forEach(function (post) {
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(post.lat, post.lon),
        map: map,
        title: post.title,
        url: post.url
      });

      marker.addListener('click', function () {
        window.location.href = this.url;
      });

      markers.push(marker);
    });

    new MarkerClusterer(map, markers, {
      gridSize: 25,
      imagePath: 'https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m'
    });
  }
</script>

</body>
